#!/bin/bash

VIRTUAL_ENV_NAME=`basename $VIRTUAL_ENV`
SUBLIME_TEXT_PROJECT_PATH="/Users/jefftriplett/Library/Application Support/Sublime Text 3/Packages/User/Projects"

if [ -d "$VIRTUAL_ENV/src" ]; then
  cd $VIRTUAL_ENV/src
else
  mkdir -p $VIRTUAL_ENV/src
  cd $VIRTUAL_ENV/src
  add2virtualenv .
  touch .envrc
  direnv allow
fi

PROJECT_FILE="${SUBLIME_TEXT_PROJECT_PATH}/${VIRTUAL_ENV_NAME}.sublime-project"

if ! [ -e "$PROJECT_FILE" ]; then
  read -p "Would you like to create a new SublimeText project for this virtualenv? " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]
  then
    echo "Creating $PROJECT_FILE"
    cat >"$PROJECT_FILE" <<EOL
{
    "folders":
    [
        {
            "path": "${VIRTUAL_ENV}/src"
        }
    ]
}
EOL
  fi
fi

# export GEM_HOME="$VIRTUAL_ENV/gems"
# export GEM_PATH=""
# export PATH=$PATH:$GEM_HOME/bin

# Set our user.badge back to our default
# export USER_BADGE="🐍"

# set our tab name
tabset --title "${VIRTUAL_ENV_NAME}"

# TODO: Ansible go...
# go get github.com/arsham/figurine
if ! [ -e figurine ]; then
  figurine "${VIRTUAL_ENV_NAME}"
fi
